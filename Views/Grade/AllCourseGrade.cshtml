@model List<EduSchool.ViewModels.AllCourseGradesViewModel1>

<head>
    <link rel="stylesheet" href="~/css/views/allcgrade.css">
</head>

<div class="container">
    @if (!Model.Any() || !Model.First().Students.Any())
    {
        <div class="alert alert-info" role="alert">
            Jelenleg nincs egyetlen tanuló sem a kurzuson.
        </div>
    }
    else
    {
        @foreach (var item in Model)
        {
            <h2>Érdemjegyek kezelése</h2>
            <table class="table">
                <thead>
                    <tr>
                        <th>Tanuló neve</th>
                        <th>Jegyei</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var student in item.Students)
                    {
                        <tr>
                            <td>@student.StudentName</td>
                            <td class="grade-cell">
                                @if (student.Grades.Any())
                                {
                                    @foreach (var grade in student.Grades)
                                    {
                                        <span class="grade-item" style="background-color: @GetGradeColor(grade.GradeValue);" data-toggle="modal" data-target="#editGradeModal" onclick="openEditModal('@grade.GradeID', '@grade.GradeValue', '@grade.GradeTitle', '@grade.Weight', '@grade.Comment', '@grade.GradeDate.ToString("yyyy-MM-dd")')">@grade.GradeValue</span>
                                    }
                                }
                                else
                                {
                                    <span>-</span>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        }

        <br />
        <a href="#" onclick="history.back(); return false;" class="btn btn-primary">Vissza</a>
    }
</div>


@functions {
    public string GetGradeColor(int gradeValue)
    {
        switch (gradeValue)
        {
            case 5: return "#8B0000"; 
            case 4: return "#FF4500"; 
            case 3: return "#FFA500"; 
            case 2: return "#9ACD32"; 
            case 1: return "#006400";
            default: return "";
        }
    }
}


<div class="modal fade" id="editGradeModal" tabindex="-1" aria-labelledby="editGradeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editGradeModalLabel">Jegy szerkesztése</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Bezárás"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="gradeId" />
                <div class="form-group">
                    <label for="gradeValue">Jegy értéke:</label>
                    <input type="number" class="form-control" id="gradeValue">
                </div>
                <div class="form-group">
                    <label for="gradeTitle">Jegy címe:</label>
                    <input type="text" class="form-control" id="gradeTitle">
                </div>
                <div class="form-group">
                    <label for="weight">Súlyozás:</label>
                    <input type="number" class="form-control" id="weight">
                </div>
                <div class="form-group">
                    <label for="comment">Megjegyzés:</label>
                    <textarea class="form-control" id="comment"></textarea>
                </div>
                <div class="form-group">
                    <label for="gradeDate">Jegy dátuma:</label>
                    <input type="date" class="form-control" id="gradeDate">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Bezárás</button>
                <button type="button" class="btn btn-primary" onclick="editGrade()">Mentés</button>
                <button type="button" class="btn btn-danger" onclick="deleteGrade()">Törlés</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function () {
            $('.grade-item').on('click', function () {
                $('#editGradeModal').modal('show');
            });
        });

        function openEditModal(gradeId, gradeValue, gradeTitle, weight, comment, gradeDate) {
            $('#gradeId').val(gradeId);
            $('#gradeValue').val(gradeValue);
            $('#gradeTitle').val(gradeTitle);
            $('#weight').val(weight);
            $('#comment').val(comment);
            $('#gradeDate').val(gradeDate);
        }

        function deleteGrade() {
            if (confirm("Biztosan törölni szeretné ezt a jegyet?")) {
                var gradeId = $('#gradeId').val();
                $.post('@Url.Action("Delete", "Grade")', { gradeId: gradeId }, function (data) {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert("Hiba történt a jegy törlésekor!");
                    }
                });
            }
        }

        function editGrade() {
            var gradeId = $('#gradeId').val();
            var gradeValue = $('#gradeValue').val();
            var gradeTitle = $('#gradeTitle').val();
            var weight = $('#weight').val();
            var comment = $('#comment').val();
            var gradeDate = $('#gradeDate').val();

            $.post('@Url.Action("Edit", "Grade")', {
                id: gradeId,
                gradeValue: gradeValue,
                gradeTitle: gradeTitle,
                weight: weight,
                comment: comment,
                gradeDate: gradeDate
            }, function (data) {
                if (data.success) {
                    $('#editGradeModal').modal('hide');
                    location.reload();
                } else {
                    alert(data.message || "Hiba történt a jegy szerkesztésekor!");
                }
            });
        }
    </script>
}